name: deleted-later
on: [push]

jobs:
  windows-why:
    runs-on: windows-latest
    continue-on-error: ${{ matrix.release == 'master' }}
    strategy:
      fail-fast: false
      matrix:
        platform: [x64]
        release: [master, 'e3f6afafdeab3c5ec8e28c3f9b6b26fbcf5f37bf']
    steps:
    - name: Print Environment Variables
      shell: cmd
      run: set
    - name: Print CMake Version
      shell: cmd
      run: cmake --version
    - name: Checkout Current Repository
      uses: actions/checkout@v2
      with:
        path: repo
    - name: Dump all CMake variables starting with CMAKE_VS_
      shell: cmd
      run: cmake -B__dummy__ -Hrepo/cmakevardump
    - name: Checkout OpenAL-soft
      uses: actions/checkout@v2
      with:
        path: openal-soft
        repository: kcat/openal-soft
        ref: ${{ matrix.release }}
    - name: Configure
      shell: cmd
      env:
        WINARCH: ${{ matrix.platform }}
      run: cmake -Bbuild -Hopenal-soft -DCMAKE_INSTALL_PREFIX=%CD%\install -A %WINARCH%
    - name: Build & Install
      shell: cmd
      run: cmake --build build --config Release --target install
